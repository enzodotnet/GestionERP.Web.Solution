@page "/cuentas-contables/{Id:guid}"

@attribute [Authorize]

@using GestionERP.Web.Models.Dtos.Principal 

@implements IDisposable

<PageTitle>Cuenta Contable - Ver</PageTitle>

<NavigationLock OnBeforeInternalNavigation="@(Cerrar)" ConfirmExternalNavigation="@(IsAuthUser && IsLoadingAction)" />

<TooltipButtonComponent/>

@if (CuentaContableObtener is not null)
{
    <CardContainerComponent Titulo="Visualizando cuenta contable" CodigoRegistro="@(CuentaContableObtener.Codigo)" CodigoServicio="@(codigoServicio)">
        <CardBody>
            <TelerikForm Model="@(CuentaContableObtener)" Size="sm">
                <FormItems>
                    <FormGroup Class="formgroup intab" Columns="2" ColumnSpacing="10px">
                        <FormItem ColSpan="2">
                            <Template>
                                <label>Activo:</label>
                                <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.Activo)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                            </Template>
                        </FormItem>
                        <FormItem ColSpan="2">
                            <Template>
                                <label>Nombre:</label>
                                <TelerikTextBox @bind-Value="@(CuentaContableObtener.Nombre)" Size="sm" Enabled="@false" />
                            </Template>
                        </FormItem>
                        <FormItem ColSpan="2">
                            <Template>
                                <label>Descripción:</label>
                                <TelerikTextBox @bind-Value="@(CuentaContableObtener.Descripcion)" Size="sm" Enabled="@false" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Plan contable:</label>
                                <div class="item-group">
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.CodigoPlanContable)" Size="sm" Width="100px" Enabled="@false" />
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.NombrePlanContable)" Title="@(CuentaContableObtener.NombrePlanContable)" Size="sm" Enabled="@false" />
                                </div>
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Bien y Servicio de la:</label>
                                <div class="item-group">
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.CodigoTipoBienServicio)" Size="sm" Width="100px" Enabled="@false" />
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.NombreTipoBienServicio)" Title="@(CuentaContableObtener.NombreTipoBienServicio)" Size="sm" Enabled="@false" />
                                </div>
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Tipo:</label>
                                <TelerikDropDownList @bind-Value="@CuentaContableObtener.FlagTipo" TextField="Nombre" ValueField="Codigo" Data="@Tipos" Enabled="@false" Size="sm" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Formato función:</label>
                                <TelerikDropDownList @bind-Value="@CuentaContableObtener.FlagFormatoFuncion" TextField="Nombre" ValueField="Codigo" Data="@FormatosFuncion" Enabled="@false" Size="sm" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Tipo naturaleza:</label>
                                <TelerikDropDownList @bind-Value="@CuentaContableObtener.FlagTipoNaturaleza" TextField="Nombre" ValueField="Codigo" Data="@TiposNaturaleza" Enabled="@false" Size="sm" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Tipo de entidad financiera:</label>
                                <TelerikDropDownList @bind-Value="@CuentaContableObtener.FlagTipoEntidadFinanciera" TextField="Nombre" ValueField="Codigo" Data="@TiposEntidadFinanciera" Enabled="@false" Size="sm" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Tipo de cuenta corriente:</label>
                                <TelerikDropDownList @bind-Value="@CuentaContableObtener.FlagTipoCuentaCorriente" TextField="Nombre" ValueField="Codigo" Data="@TiposCuentaCorriente" Enabled="@false" Size="sm" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta de destino:</label>
                                <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.EsCuentaDestino)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta tipo orden:</label>
                                <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.EsCuentaOrden)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta vinculado a banco:</label>
                                <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.EsCuentaVinculoBanco)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta balance de comprobación:</label>
                                <div class="item-group">
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.CodigoCuentaBalance)" Size="sm" Width="100px" Enabled="@false" />
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.NombreCuentaBalance)" Title="@(CuentaContableObtener.NombreCuentaBalance)" Size="sm" Enabled="@false" />
                                </div>
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta casilla de comprobación:</label>
                                <div class="item-group">
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.CodigoCasillaBalance)" Size="sm" Width="100px" Enabled="@false" />
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.NombreCasillaBalance)" Title="@(CuentaContableObtener.NombreCasillaBalance)" Size="sm" Enabled="@false" />
                                </div>
                            </Template>
                        </FormItem>
                        <FormItem>
                            <Template>
                                <label>Cuenta detalle casilla de comprobación:</label>
                                <div class="item-group">
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.CodigoCasillaBalanceDetalle)" Size="sm" Width="100px" Enabled="@false" />
                                    <TelerikTextBox @bind-Value="@(CuentaContableObtener.NombreCasillaBalanceDetalle)" Title="@(CuentaContableObtener.NombreCasillaBalanceDetalle)" Size="sm" Enabled="@false" />
                                </div>
                            </Template>
                        </FormItem>
                    </FormGroup>

                    <FormItem Field="ExigeEntidadComprobante">
                        <Template>
                            <label>Entidad comprobante:</label>
                            <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.ExigeEntidadComprobante)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                        </Template>
                    </FormItem>
                    <FormItem Field="ExigeCentroCosto">
                        <Template>
                            <label>Centro de costo:</label>
                            <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.ExigeCentroCosto)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                        </Template>
                    </FormItem>
                    <FormItem Field="ExigeMonedaExtranjera">
                        <Template>
                            <label>Moneda extranjera:</label>
                            <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.ExigeMonedaExtranjera)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                        </Template>
                    </FormItem>
                    <FormItem Field="ExigeCuentaExistencia">
                        <Template>
                            <label>Cuenta existencia:</label>
                            <TelerikSwitch OnLabel="Sí" OffLabel="No" @bind-Value="@(CuentaContableObtener.ExigeCuentaExistencia)" Enabled="@false" Size="sm" TrackRounded="md" ThumbRounded="md" />
                        </Template>
                    </FormItem>

                    <FormItem Field="GrdDetalle">
                        <Template>
                            <TelerikGrid Height="auto" Data="@(CuentaContableObtener.Detalles)" Pageable="false" Sortable="true" Resizable="false" Size="sm">
                                <GridColumns>
                                    <GridColumn Field="FlagRegistro" Width="80px" Title="Registro">
                                        <Template>
                                            <TelerikDropDownList @bind-Value="@((context as CuentaContableDetalleObtenerDto).FlagRegistro)" FillMode="solid" TextField="Nombre" ValueField="Codigo" Data="@DetalleRegistros" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="FlagTipo" Width="80px" Title="Tipo">
                                        <Template>
                                            <TelerikDropDownList @bind-Value="@((context as CuentaContableDetalleObtenerDto).FlagTipo)" FillMode="solid" TextField="Nombre" ValueField="Codigo" Data="@DetalleTipos" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="FlagTipoCambio" Width="80px" Title="Tipo de Cambio">
                                        <Template>
                                            <TelerikDropDownList @bind-Value="@((context as CuentaContableDetalleObtenerDto).FlagTipoCambio)" FillMode="solid" TextField="Nombre" ValueField="Codigo" Data="@DetalleTiposCambio" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="CodigoCuentaContableGanancia" Width="100px" Title="Cuenta Contable Ganancia">
                                        <Template>
                                            <TelerikTextBox @bind-Value="@((context as CuentaContableDetalleObtenerDto).CodigoCuentaContableGanancia)" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="CodigoCuentaContablePerdida" Width="100px" Title="Cuenta Contable Pérdida">
                                        <Template>
                                            <TelerikTextBox @bind-Value="@((context as CuentaContableDetalleObtenerDto).CodigoCuentaContablePerdida)" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Width="100px" Title="Acciones">
                                        <Template>
                                            @{
                                                CuentaContableDetalleObtenerDto item = context as CuentaContableDetalleObtenerDto;
                                            }
                                            <TelerikButton Icon="@(SvgIcon.Eye)" Size="sm" Id="tbtn" Title="Ver ítem" Class="b-primary" ButtonType="@ButtonType.Button" OnClick="@(() => VerItemDetalle(item))" />
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                                <NoDataTemplate>
                                    <span>No existen ítems registrados</span>
                                </NoDataTemplate>
                            </TelerikGrid>
                        </Template>
                    </FormItem>

                    <FormItem Field="GrdDestinos">
                        <Template>
                            <TelerikGrid Height="auto" Data="@(CuentaContableObtener.Destinos)" Pageable="false" Sortable="true" Resizable="false" Size="sm" Class="">
                                <GridColumns>
                                    <GridColumn Field="FlagTipo" Width="100px" Title="Tipo">
                                        <Template>
                                            <TelerikDropDownList @bind-Value="@((context as CuentaContableDestinoObtenerDto).FlagTipo)" FillMode="solid" TextField="Nombre" ValueField="Codigo" Data="@DestinoTipos" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Field="CodigoCuentaContableGenera" Width="100px" Title="Cuenta Contable Genera">
                                        <Template>
                                            <TelerikTextBox @bind-Value="@((context as CuentaContableDestinoObtenerDto).CodigoCuentaContableGenera)" Size="sm" Enabled="false" />
                                        </Template>
                                    </GridColumn>
                                    <GridColumn Width="50px" Title="Acciones">
                                        <Template>
                                            @{
                                                CuentaContableDestinoObtenerDto item = context as CuentaContableDestinoObtenerDto;
                                            }
                                            <TelerikButton Icon="@(SvgIcon.Eye)" Size="sm" Id="tbtn" Title="Ver ítem" Class="b-primary" ButtonType="@ButtonType.Button" OnClick="@(() => VerItemDestino(item))" />
                                        </Template>
                                    </GridColumn>
                                </GridColumns>
                                <NoDataTemplate>
                                    <span>No existen ítems registrados</span>
                                </NoDataTemplate>
                            </TelerikGrid>
                        </Template>
                    </FormItem>
                </FormItems>

                <FormItemsTemplate Context="formContext">
                    @{
                        List<IFormItemBase> formObjects = formContext.Items;
                        List<IFormItem> items = [];
                        List<IFormGroup> groups = [];
                        foreach (IFormItemBase itemBase in formObjects)
                        {
                            if (itemBase is IFormGroup)
                                groups.Add((IFormGroup)itemBase);
                            else
                                items.Add((IFormItem)itemBase);
                        }
                    }
                    <TelerikTabStrip Height="535px">
                        <TabStripTab Title="Datos Principales">
                            <TelerikFormGroupRenderer Group="@(groups[0])">
                                <Template Context="groupContext">
                                    @foreach (IFormItem itemGroup in groupContext.Items)
                                    {
                                        <TelerikFormItemRenderer Item="@itemGroup" />
                                    }
                                </Template>
                            </TelerikFormGroupRenderer>
                        </TabStripTab>

                        <TabStripTab Title="Exigencias">
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "ExigeEntidadComprobante"))" />
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "ExigeCentroCosto"))" />
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "ExigeMonedaExtranjera"))" />
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "ExigeCuentaExistencia"))" />
                        </TabStripTab>

                        <TabStripTab Title="Diferencia de cambio - Traducción monetaria">
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "GrdDetalle"))" />
                        </TabStripTab>

                        <TabStripTab Title="Cuentas Destino">
                            <TelerikFormItemRenderer Item="@(items.First(x => x.Field == "GrdDestinos"))" />
                        </TabStripTab>

                    </TelerikTabStrip>
                </FormItemsTemplate>

                <FormButtons/>
            </TelerikForm>

            <TelerikToolBar Class="toolbar-mainform">
                <ToolBarTemplateItem>
                    <TelerikButton Icon="@(SvgIcon.Undo)" Id="tbtn" Title="Volver a la vista del listado" ButtonType="@ButtonType.Button" Size="sm" ThemeColor="primary" OnClick="@(Volver)">Volver</TelerikButton>
                </ToolBarTemplateItem>
                <ToolBarSeparator />
                <ToolBarTemplateItem>
                    <TelerikButton Icon="@(SvgIcon.Pencil)" Id="tbtn" Title="Ir a editar registro" ButtonType="ButtonType.Button" Class="b-primary btn-auth" Enabled="@(EsAsignadoEditar)" Size="sm" OnClick="@(IrEditar)">Editar</TelerikButton>
                </ToolBarTemplateItem>
                <ToolBarTemplateItem>
                    <TelerikButton Icon="@(SvgIcon.Trash)" Id="tbtn" Title="Eliminar registro" ButtonType="ButtonType.Button" Class="b-delete btn-auth" Enabled="@(EsAsignadoEliminar)" Size="sm" OnClick="@(() => EsVisibleDialogEliminar = true)">Eliminar</TelerikButton>
                </ToolBarTemplateItem>
            </TelerikToolBar>

            <TelerikWindow Visible="@EsVisibleModalDetalle" VisibleChanged="@VisibleDetalleChangedHandler" Modal="true" Height="auto" Width="500px" MinWidth="500px" CloseOnOverlayClick="false">
                <WindowTitle>Visualizando ítem de detalle</WindowTitle>
                <WindowActions>
                    <WindowAction Name="Maximize" Title="Maximizar" />
                    <WindowAction Name="Close" Title="Cerrar" />
                </WindowActions>
                <WindowContent>
                    <TelerikForm Model="@Detalle" Size="sm">
                        <FormItems>
                            <FormItem>
                                <Template>
                                    <label>Registro:</label>
                                    <TelerikDropDownList @bind-Value="@(Detalle.FlagRegistro)" TextField="Nombre" ValueField="Codigo" Data="@DetalleRegistros" Enabled="@false" Size="sm" />
                                </Template>
                            </FormItem>
                            <FormItem>
                                <Template>
                                    <label>Tipo:</label>
                                    <TelerikDropDownList @bind-Value="@(Detalle.FlagTipo)" TextField="Nombre" ValueField="Codigo" Data="@DetalleTipos" Enabled="@false" Size="sm" />
                                </Template>
                            </FormItem>
                            <FormItem>
                                <Template>
                                    <label>Tipo de cambio:</label>
                                    <TelerikDropDownList @bind-Value="@(Detalle.FlagTipoCambio)" TextField="Nombre" ValueField="Codigo" Data="@DetalleTiposCambio" Enabled="@false" Size="sm" />
                                </Template>
                            </FormItem>
                            <FormItem>
                                <Template>
                                    <label>Cuenta contable de Ganancia:</label>
                                    <div class="item-group">
                                        <TelerikTextBox @bind-Value="@(Detalle.CodigoCuentaContableGanancia)" Size="sm" Width="100px" Enabled="@false" />
                                        <TelerikTextBox @bind-Value="@(Detalle.NombreCuentaContableGanancia)" Title="@(Detalle.NombreCuentaContableGanancia)" Size="sm" Enabled="@false" />
                                    </div>
                                </Template>
                            </FormItem>
                            <FormItem>
                                <Template>
                                    <label>Cuenta contable de Pérdida:</label>
                                    <div class="item-group">
                                        <TelerikTextBox @bind-Value="@(Detalle.CodigoCuentaContablePerdida)" Size="sm" Width="100px" Enabled="@false" />
                                        <TelerikTextBox @bind-Value="@(Detalle.NombreCuentaContablePerdida)" Title="@(Detalle.NombreCuentaContablePerdida)" Size="sm" Enabled="@false" />
                                    </div>
                                </Template>
                            </FormItem>
                        </FormItems>
                        <FormButtons />
                    </TelerikForm>
                </WindowContent>
            </TelerikWindow>

            <TelerikWindow Visible="@EsVisibleModalDestino" VisibleChanged="@VisibleDestinoChangedHandler" Modal="true" Height="auto" Width="500px" MinWidth="500px" CloseOnOverlayClick="false">
                <WindowTitle>Visualizando ítem de destino</WindowTitle>
                <WindowActions>
                    <WindowAction Name="Maximize" Title="Maximizar" />
                    <WindowAction Name="Close" Title="Cerrar" />
                </WindowActions>
                <WindowContent>
                    <TelerikForm Model="@DestinoObtener" Size="sm">
                        <FormItems>
                            <FormItem>
                                <Template>
                                    <label>Tipo:</label>
                                    <TelerikDropDownList @bind-Value="@(DestinoObtener.FlagTipo)" TextField="Nombre" ValueField="Codigo" Data="@DestinoTipos" Enabled="@false" Size="sm" />
                                </Template>
                            </FormItem>
                            <FormItem>
                                <Template>
                                    <label>Cuenta contable que genera:</label>
                                    <div class="item-group">
                                        <TelerikTextBox @bind-Value="@(DestinoObtener.CodigoCuentaContableGenera)" Size="sm" Width="100px" Enabled="@false" />
                                        <TelerikTextBox @bind-Value="@(DestinoObtener.NombreCuentaContableGenera)" Title="@(DestinoObtener.NombreCuentaContableGenera)" Size="sm" Enabled="@false" />
                                    </div>
                                </Template>
                            </FormItem>
                        </FormItems>
                        <FormButtons />
                    </TelerikForm>
                </WindowContent>
            </TelerikWindow>

            <TelerikDialog @bind-Visible="@EsVisibleDialogEliminar" Width="auto" ShowCloseButton="@(false)" CloseOnOverlayClick="@(false)" ThemeColor="primary" FocusedElementSelector=".ok-btn" ButtonsLayout="@(DialogButtonsLayout.Center)">
                <DialogTitle><TelerikSvgIcon Size="md" Icon="@(SvgIcon.Trash)" />Eliminando cuenta contable</DialogTitle>
                <DialogContent> ¿Está seguro de eliminar el registro? </DialogContent>
                <DialogButtons>
                    <TelerikButton Class="ok-btn" Icon="@(SvgIcon.Check)" ThemeColor="primary" OnClick="@(Eliminar)" Size="sm" Enabled="@(!IsLoadingAction)">Sí</TelerikButton>
                    <TelerikButton Class="undo-btn" Icon="@(SvgIcon.X)" ButtonType="@ButtonType.Button" OnClick="@(() => { EsVisibleDialogEliminar = false; })" Size="sm" Visible="@(!IsLoadingAction)">No</TelerikButton>
                </DialogButtons>
            </TelerikDialog>

        </CardBody>
    </CardContainerComponent>
}